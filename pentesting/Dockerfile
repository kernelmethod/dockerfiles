FROM alpine:latest

# Packages for building software
RUN apk update \
    && apk add \
        --no-cache \
        # Tools for building software
        build-base \
        gcc \
        gcc-doc \
        abuild \
        binutils \
        binutils-doc \
        libffi \
        libffi-dev \
        python3-dev \
        # Common utilities
        bash \
        findutils \
        python3 \
        git \
        vim \
        curl \
        wget \
    && ln -s \
        $(which python3) \
        /usr/bin/python

###
### Add pentesting tools. Place symlinks to all tools in TOOL_DIR.
###
ENV TOOL_DIR /usr/bin/pentesting-tools
RUN mkdir -p ${TOOL_DIR} \
    && echo -e "export PATH=${TOOL_DIR}:\$PATH" \
        >> /root/.bashrc \
    # Add a command that, when executed, displays all of the tools
    # in the tool directory
    && printf \
        "#\041/bin/sh\nls ${TOOL_DIR}\n" \
        >> /usr/bin/show-tools \
    && chmod 755 /usr/bin/show-tools

### TheHarvester: https://github.com/laramies/theHarvester
RUN git clone \
		--depth 1 \
        https://github.com/laramies/theHarvester.git \
		"/usr/share/theHarvester" \
	&& python -B -m \
	    pip install \
	    --no-cache-dir \
		-r "/usr/share/theHarvester/requirements.txt" \
	&& bash -c "\
	    cat <(echo '#!/usr/bin/python') \
		    <(tail -n +2 '/usr/share/theHarvester/theHarvester.py') > \
		    '/usr/share/theHarvester/theHarvester.py'" \
	&& ln -s /usr/share/theHarvester/theHarvester.py ${TOOL_DIR}/theHarvester

### gobuster: https://github.com/OJ/gobuster/
RUN apk add --no-cache go \
    && go get github.com/OJ/gobuster \
    && mv ${HOME}/go/bin/gobuster ${TOOL_DIR}/gobuster \
    && apk del --purge go \
    && rm -rf ${HOME}/go

### nmap: https://nmap.org/
RUN apk add --no-cache nmap \
	&& ln -s $(which nmap) ${TOOL_DIR}/nmap

### wfuzz: https://github.com/xmendez/wfuzz/
RUN apk add --no-cache curl-dev \
    && mkdir -p /usr/share/wfuzz \
    && git clone \
        --depth 1 \
        https://github.com/xmendez/wfuzz.git /usr/share/wfuzz \
    && python -B -m pip install -q --no-cache-dir \
        -r "/usr/share/wfuzz/requirements.txt" \
    && chmod a+x /usr/share/wfuzz/src/wfuzz-cli.py \
    && ln -s /usr/share/wfuzz/src/wfuzz-cli.py ${TOOL_DIR}/wfuzz

### sqlmap: https://github.com/sqlmapproject/sqlmap
RUN git clone --depth 1 \
        https://github.com/sqlmapproject/sqlmap.git \
		/usr/share/sqlmap \
	&& ln -s \
	    /usr/share/sqlmap/sqlmap.py \
	    ${TOOL_DIR}/sqlmap

### John the Ripper: https://www.openwall.com/john/
RUN apk add --no-cache -q john \
	&& ln -s \
	    $(which john) \
	    ${TOOL_DIR}/john

### Wordlists
RUN mkdir /usr/share/wordlists \
    && git clone \
        --depth 1 \
        https://github.com/danielmiessler/SecLists.git \
        /usr/share/wordlists/SecLists

# TODO:
# - Metasploit

WORKDIR /root
ENTRYPOINT bash
